<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Document</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Heebo:wght@100;200;300;400;500;600;700;800;900&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                font-family: "Heebo", sans-serif;
                text-align: center;
                margin: 0;
                box-sizing: border-box;
            }
            body {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-direction: column;
                height: 100vh;
                padding: 2em;
                font-size: 20px;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                cursor: pointer;
            }
            textarea {
                font-size: 2em;
                resize: none;
                width: 80%;
            }
            main {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }
        </style>
    </head>
    <body>
        <textarea></textarea>
        <main>
            <h1></h1>
            <h2></h2>
            <h3></h3>
            <h4></h4>
            <h5></h5>
            <h6></h6>
        </main>
        <script>
            console.clear();

            const input = document.querySelector("textarea");
            const h1 = document.querySelector("h1");
            const h2 = document.querySelector("h2");
            const h3 = document.querySelector("h3");
            const h4 = document.querySelector("h4");
            const h5 = document.querySelector("h5");
            const h6 = document.querySelector("h6");

            const array = [
                "banana",
                "apple",
                "orange",
                "cherry",
                "pineapple",
                "lemon",
                "strawberry",
                "avocado",
                "apricot",
                "nectarine",
                "pear",
                "papaya",
                "peach",
                "grapefruit",
                "plum",
                "grapes",
                "pomegranate",
                "kiwi",
                "lime",
                "mango",
                "melon",
                "watermelon",
                "blueberry",
                "blackberry",
                "cranberry",
                "currant",
                "chokeberry",
                "gooseberry",
                "raspberry",
            ];

            var results = [];

            class Result {
                Input = "";
                Target = "";
                #IndexOfSimilarity = -1;

                get IndexOfSimilarity() {
                    if (this.#IndexOfSimilarity == -1) {
                        this.#IndexOfSimilarity = this.#GetIndexOfSimilarity();
                    }

                    return this.#IndexOfSimilarity;
                }

                constructor(input, target) {
                    this.Input = input;
                    this.Target = target;
                }
                #FindSumbolsCount(str) {
                    let result = [[], []];
                    debugger
                    for (let i = 0; i < str.length; i++) {
                        let index = result[0].indexOf(str[i]);
                        if (index == -1) {
                            result[0].push(str[i]);
                            result[1].push(1);
                        } else {
                            result[1][index]++;
                        }
                    }

                    return result;
                }

                #GetSimilarityCount() {
                    let index = 0;
                    for (
                        let i = 0;
                        i < this.Target.length || i < this.Input.length;
                        i++
                    ) {
                        if (this.Target[i] == this.Input[i]) {
                            index++;
                        }
                    }

                    return index;
                }

                #IsSubString() {
                    let str =
                        this.Target.length >= this.Input.length
                            ? this.Target
                            : this.Input;
                    let substr =
                        this.Target.length < this.Input.length
                            ? this.Target
                            : this.Input;

                    for (let i = 0, k = 0; i < str.length; i++) {
                        if (str[i] == substr[k]) {
                            if (k == substr.length - 1) {
                                return true;
                            }

                            k++;
                        }
                    }

                    return false;
                }

                #GetIndexOfSimilarity() {
                    let max =
                        this.Target.length >= this.Input.length
                            ? this.Target.length
                            : this.Input.length;
                    let cur = this.#GetSimilarityCount();
                    let count = cur / max;

                    let isSub = this.#IsSubString() ? 1 : 0;

                    let inputcount = this.#FindSumbolsCount(this.Input);
                    let targetcount = this.#FindSumbolsCount(this.Target);

                    let prev = targetcount[0].length;

                    for (
                        let i = 0;
                        i < targetcount[0].length && inputcount[0].length > 0;
                        i++
                    ) {
                        let index = inputcount[0].indexOf(targetcount[0][i]);

                        if (index != -1) {
                            if (targetcount[1][i] > inputcount[1][index]) {
                                targetcount[0][i] -= inputcount[1][index];

                                inputcount[0].splice(index, 1);
                                inputcount[1].splice(index, 1);
                            } else if (
                                targetcount[1][i] < inputcount[1][index]
                            ) {
                                inputcount[1][index] -= targetcount[1][i];

                                targetcount[0].splice(i, 1);
                                targetcount[1].splice(i, 1);

                                i--;
                            } else {
                                inputcount[0].splice(index, 1);
                                inputcount[1].splice(index, 1);

                                targetcount[0].splice(i, 1);
                                targetcount[1].splice(i, 1);

                                i--;
                            }
                        }
                    }

                    let left = 1 - targetcount[0].length / prev;

                    return (count + isSub + left) / 3;
                }

                ToString() {
                    return this.#IndexOfSimilarity > 0
                        ? this.Target +
                              "<br>(" +
                              Math.round(this.#IndexOfSimilarity * 100) +
                              "%" +
                              ")"
                        : "";
                }
            }

            var words = [];

            input.onkeyup = changed;
            h1.onclick = clicked;
            h2.onclick = clicked;
            h3.onclick = clicked;
            h4.onclick = clicked;
            h5.onclick = clicked;
            h6.onclick = clicked;

            function changed() {
                results = [];

                words = input.value.split(" ");

                array.forEach((f) => {
                    results.push(
                        new Result(words[words.length - 1].toLowerCase(), f)
                    );
                });

                // const result = results.reduce((max, obj) =>
                //     max.GetIndexOfSimilarity() > obj.GetIndexOfSimilarity()
                //         ? max
                //         : obj
                // );

                //h1.innerHTML = result.Target;

                results = results.sort((a, b) => {
                    return a.IndexOfSimilarity > b.IndexOfSimilarity ? -1 : 1;
                });

                h1.innerHTML = results[0].ToString();
                h2.innerHTML = results[1].ToString();
                h3.innerHTML = results[2].ToString();
                h4.innerHTML = results[3].ToString();
                h5.innerHTML = results[4].ToString();
                h6.innerHTML = results[5].ToString();
            }

            function clicked() {
                word = this.innerHTML.split("<br>")[0];
                words[words.length - 1] = word;
                input.value = "";
                words.forEach((f) => (input.value += f + " "));

                input.focus();
                input.setSelectionRange(input.value.length, input.value.length);
                changed();
            }
        </script>
    </body>
</html>

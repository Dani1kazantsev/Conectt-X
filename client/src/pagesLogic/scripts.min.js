let $web = document.querySelector(".preview__about");
let $blockWeb = document.querySelector(".preview__buttons");
let $name = document.querySelector('#name');
let $nameText = document.querySelector('#name-text');
let $userName = document.querySelector('.web__input');
let $webLink = document.querySelector('.web__link');

function form() {
  let downloadBtn = document.querySelector('.preview__download');
  let form = document.querySelector('#form');
  $web.style.display = 'none';
  downloadBtn.style.display = 'none';
  form.style.display = 'flex';
  form.style.gap = '10px';
}
function parseJwt(token) {
    let base64Url = token.split('.')[1];
    let base64 = decodeURIComponent(atob(base64Url).split('').map(function (c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(base64);
};

$web.addEventListener("click", form);

document.querySelector('#form').addEventListener('keypress', e =>{
    if(e.which == 13){
        let emailValue = document.querySelector('.web__input').value;
        let passwordValue = document.querySelector('#password').value;
        if(emailValue == ""){
            alert("Пустое поле");
            return;
        }
        if(passwordValue.length < 6){
            alert("Слишком короткий пароль");
            return;
        }
        axios.post('/auth/login',{
            email:emailValue,
            password:passwordValue
        },{withCredentials:true,baseURL:API_URL,}).then(response=>{
            localStorage.setItem('token',response.data)
            myAxios.get(`users/me${parseJwt(response.data).id}`).then(res=>{
                localStorage.setItem('me',JSON.stringify(res.data))
                location.href = 'messenger.html'
            })
        }).catch(err=>{
            alert('Нет такого пользователя')
        })
    }
})
document.querySelector('.web__link ').addEventListener('click',e =>{
  let emailValue = document.querySelector('.web__input').value;
  let passwordValue = document.querySelector('#password').value;
  if(emailValue == ""){
      alert("Пустое поле");
      return;

  }
    axios.post('/auth/login',{
        email:emailValue,
        password:passwordValue
    },{withCredentials:true,baseURL:API_URL,}).then(response=>{
        localStorage.setItem('token',response.data)
        myAxios.get(`users/me${parseJwt(response.data).id}`).then(res=>{
            localStorage.setItem('me',JSON.stringify(res.data))
            location.href = 'messenger.html'
        })
    }).catch(err=>{
        alert('Нет такого пользователя')
    })
})
document.querySelector('.web__eye').addEventListener('click',e=>{
    if(document.querySelector('#password').type == "text"){
        document.querySelector('#password').type = ["password"];
        document.querySelector('.web__eye').setAttribute('src','src/img/manifest/icons/hide-password.svg');
    }
    else{
        document.querySelector('#password').type = "text";
        document.querySelector('.web__eye').setAttribute('src','src/img/manifest/icons/open-password.svg');
    }

})
